helmCharts:
- includeCRDs: true
  name: vcluster
  namespace: global-vc0
  releaseName: vcluster
  repo: https://charts.loft.sh
  valuesInline:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: env
              operator: In
              values:
              - global
    fallbackHostDns: true
    multiNamespaceMode:
      enabled: true
    service:
      loadBalancerClass: tailscale
      type: LoadBalancer
    sync:
      generic:
        clusterRole:
          extraRules:
          - apiGroups:
            - apiextensions.k8s.io
            resources:
            - customresourcedefinitions
            verbs:
            - get
            - list
            - watch
        config: "version: v1beta1\nexport:\n  - kind: Component\n\tapiVersion: dapr.io/v1alpha1\n
          \ - kind: Configuration\n\tapiVersion: dapr.io/v1alpha1\n  - kind: Resiliency\n\tapiVersion:
          dapr.io/v1alpha1\n  - kind: Subscription\n\tapiVersion: dapr.io/v1alpha1\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Service\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Configuration\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Revision\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Route\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']\nimport:\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Service\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Configuration\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Revision\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']\n
          \ - apiVersion: serving.knative.dev/v1\n    kind: Route\n    patches:\n
          \     - op: copyFromObject\n        fromPath: .metadata.annotations['argocd.argoproj.io/tracking-id']\n
          \       path: .metadata.annnotations['argocd.argoproj.io/tracking-id']"
        role:
          extraRules:
          - apiGroups:
            - serving.knative.dev
            resources:
            - services
            - configurations
            - revisions
            - routes
            verbs:
            - create
            - delete
            - patch
            - update
            - get
            - list
            - watch
          - apiGroups:
            - dapr.io
            resources:
            - components
            - configurations
            - resiliencies
            - subscriptions
            verbs:
            - create
            - delete
            - patch
            - update
            - get
            - list
            - watch
      nodes:
        enabled: true
        nodeSelector: env=global
    syncer:
      extraArgs:
      - --tls-san=vcluster.global-vc0.svc.cluster.local
      - --enforce-toleration=env=global-vc0:NoSchedule
    tolerations:
    - key: env
      operator: Equal
      value: global
    vcluster:
      image: rancher/k3s:v1.24.13-k3s1
  version: 0.15.0
namespace: global-vc0
resources:
- resource-namespace-vcluster.yaml
