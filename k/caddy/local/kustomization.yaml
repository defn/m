helmCharts:
- includeCRDs: true
  name: caddy
  namespace: caddy
  releaseName: caddy
  repo: https://charts.alekc.dev
  valuesInline:
    config:
      caddyFile: "map {http.request.host.labels.2} $upstream_scheme {\n\t\"default\"
        \"http\"\n}\n\nhttps://argocd.defn.run {\n\ttls /certs/tls.crt /certs/tls.key\n\treverse_proxy
        https://argocd-server.argocd.svc.cluster.local {\n\t\ttransport http {\n\t\t\ttls\n\t\t\ttls_insecure_skip_verify\n\t\t}\n\t}\n}\n\nhttps://*.defn.run
        {\n\ttls /certs/tls.crt /certs/tls.key\n\treverse_proxy {$upstream_scheme}://{http.request.host.labels.2}.default.svc.cluster.local
        {\n\t\theader_up -Host\n\t\theader_up X-defn-label0\t\"{http.request.host.labels.0}\"\n\t\theader_up
        X-defn-label1\t\"{http.request.host.labels.1}\"\n\t\theader_up X-defn-label2\t\"{http.request.host.labels.2}\"\n\t}\n}"
      global: "local_certs\nlog {\n\toutput stdout\n}"
    https:
      enabled: true
      port: 443
    listenPort: 80
    volumeMounts:
    - mountPath: /certs
      name: certs
    volumes:
    - name: certs
      secret:
        optional: false
        secretName: defn-run-wildcard
  version: 0.2.4
namespace: caddy
patches:
- path: patch-service-tailscale.yaml
resources:
- resource-namespace-caddy.yaml
